(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{368:function(t,s,a){"use strict";a.r(s);var r=a(10),e=Object(r.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"第一章-周介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第一章-周介绍"}},[t._v("#")]),t._v(" 第一章：周介绍")]),t._v(" "),s("p",[s("strong",[t._v("1-1 介绍")])]),t._v(" "),s("p",[t._v("服务端 CI/CD流程--让 github 自动化为我们服务"),s("br"),t._v("\nCI:    Continuous Integration  持续集成"),s("br"),t._v("\nCD:   Continuous Delivery     持续交付"),s("br"),t._v("\n合理全面的 CI/CD，自动化研发流程，提高研发效率，增加系统稳定性")]),t._v(" "),s("p",[s("strong",[t._v("收获")])]),t._v(" "),s("ul",[s("li",[t._v("使用 Github actions 进行 CI/CD")]),t._v(" "),s("li",[t._v("学会 Docker 在 nodejs 中的应用")]),t._v(" "),s("li",[t._v("搭建测试环境")])]),t._v(" "),s("p",[t._v("关键词")]),t._v(" "),s("ul",[s("li",[t._v("CI/CD")]),t._v(" "),s("li",[t._v("Github actions：实现 CI/CD 的一个工具")]),t._v(" "),s("li",[t._v("Docker Docker-compose")])]),t._v(" "),s("p",[t._v("链接："),s("a",{attrs:{href:"https://www.redhat.com/zh/topics/devops/what-is-ci-cd",target:"_blank",rel:"noopener noreferrer"}},[t._v("CI/CD 介绍"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"第二章-github-actions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第二章-github-actions"}},[t._v("#")]),t._v(" 第二章 Github actions")]),t._v(" "),s("p",[t._v("这一章讲的真的不知道讲了个啥，自己课下补吧，真是一塌糊涂。"),s("br"),t._v("\ngithub actions 的学习确实很有必要啊，回头等学习完毕再来吐槽。"),s("br"),t._v("\n学习阮一峰大哥的这节文档：http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html")]),t._v(" "),s("p",[s("strong",[t._v("第二遍视频笔记记录如下")]),t._v(" "),s("strong",[t._v("2-1 章介绍")])]),t._v(" "),s("ul",[s("li",[t._v("Github actions 是github 官方发布的一个产品 。")]),t._v(" "),s("li",[t._v("使用 Github actions 自动化构建和测试")]),t._v(" "),s("li",[t._v("认识 Github actions")]),t._v(" "),s("li",[t._v("注意：接口测试会依赖于测试机搭建。")]),t._v(" "),s("li",[t._v("二八法则。")]),t._v(" "),s("li",[t._v("疑问：为了主流程跑通，不让边角东西打扰我们主流程，难道不注释掉那些代码就不能演示吗？后面再接上，这里的我要搞明白为什么在讲课代码演示的时候，是否为了讲师自己方便注释划水讲课。")]),t._v(" "),s("li",[t._v("疑问二：既然不是讲 Github actions 和 Docker 的一门课，又为什么抽出一周的时间来划水(老师的答案可能是后面确实是用到这个知识了，有必要了解一下，那我的疑问又来了，既然用到了，又讲到了，那肯定默认这部分内容是很重要的，作为一门架构课，是不是应该认真对待每一周每一节课的录制，即使不那么深入，起码基础的内容得讲明白，这是必须的吧)")]),t._v(" "),s("li",[t._v("疑问三：课程是以业务为导向，不可能把全部细节都讲出来，这个无可厚非，没有毛病，那你好歹把基础的大路边的内容，起码普及个差不多吧。")]),t._v(" "),s("li",[t._v("疑问四：这节章介绍内容，你讲解那么多二八法则是干嘛？讲解什么边际效应，是为了后续课程划水先找借口吗？")])]),t._v(" "),s("p",[s("strong",[t._v("2-2 认识 Github actions")])]),t._v(" "),s("ul",[s("li",[t._v("00:00-01:00：由于中美时差造成的 Github 不稳定问题。")]),t._v(" "),s("li",[t._v("01:00-01:50：讲解了githu被微软收购，变得更好些，有了私有化个人项目，对中小企业越来越友好")]),t._v(" "),s("li",[t._v("01:50-02:10:讲解了课程为什么代码不公开的原因是一些数据的线上原因，此事说过好几遍，\n"),s("ul",[s("li",[t._v("(疑问:有敏感数据，代码公开直接将重要数据脱敏这个方案是否可行？又是否因为写代码的课程录制繁琐而不公开仓库)")])])]),t._v(" "),s("li",[t._v("02:10-04:15: 链接一介绍：进入一个项目，讲解如何查找 actions，以及 actions 下面的页面展示，得出的结论：帮助你在项目根目录下新建.github/workflow/xxx.yml 文件。")]),t._v(" "),s("li",[t._v("04:16-06:20:链接二介绍，官方翻译版本，挑选了 node.js 发布中的命令 npm install,npm publish，以及 secrets 的点名。")]),t._v(" "),s("li",[t._v("06:20-07：00 :拿出代码，介绍有这个文件，然后我们介绍这个文件前，先去看应用场景。")]),t._v(" "),s("li",[t._v("07:00-08:50:应用场景、范围介绍，打开开源的项目，介绍有三个文件名 yml，test.yml 对应master 分支，自动化测试，dev 分支即deploy-dev.yml--自动部署到测试机，v.x.x.x格式的 tag，自动上线--deploy-pro.yml")]),t._v(" "),s("li",[t._v("08:50- 17:13 :代码演示\n"),s("ul",[s("li",[t._v("08:50-09:10: 讲解注释，去掉注释，添加注释")]),t._v(" "),s("li",[t._v("09:10-10:15: 中心思想为讲解 name 的命名要语义化\n"),s("ul",[s("li",[t._v("(补充：name 可以省略，省略的话，默认以文件名命名，还有一点演示过程中，yml 文件名称改为 demo，yml 文件内容也更改为demo，会让人误以为这个 name 的命名必须以文件名字命名，其实不是，文件的命令与文件内容中 name 的命名没有关联)")])])]),t._v(" "),s("li",[t._v("10:15-12:24: on/push/branches/paths的讲解，其中 paths 讲解可以简练点，讲的啰嗦了\n"),s("ul",[s("li",[t._v("(补充：on字段可以是事件数组比如 on:[push,pull_request]]),branches可以限定分支或"),s("strong",[t._v("标签")]),t._v("）")])])]),t._v(" "),s("li",[t._v("12:24-17:13:jobs 讲解。\n"),s("ul",[s("li",[t._v("（补充：runs-on 没什么特殊情况下直接使用 ubuntu-latest,还有可以设置的比如windows-latest，macOS-latest，steps 中 uses 中的 actions/checkout@v2,实际上代表的是github.com/actions/checkout 这个仓库，actions/xxx 中的东西，都是仓库中的内容，GitHub 官方的 actions 都放在 "),s("a",{attrs:{href:"https://github.com/actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("github.com/actions"),s("OutboundLink")],1),t._v(" 里面）")])])])])])]),t._v(" "),s("p",[s("strong",[t._v("2-3 Github actions 功能演示")])]),t._v(" "),s("ul",[s("li",[t._v("00:00-00:50：run为自定义命令。如果为多个命令，则格式为 run: | 。")]),t._v(" "),s("li",[t._v("00:50-02:00：演示 run 命令 touch、echo、cat。")]),t._v(" "),s("li",[t._v("03:00-03:50：代码提交--将branch 改为本地代码分支，演示本地分支提交触发流程，其中关于 .docker-volumes/加到 ignore，具体干啥的留个问号。还有 commit 规范这块前面"),s("strong",[t._v("貌似")]),t._v("没讲是如何控制规范的「ci 工具」？")]),t._v(" "),s("li",[t._v("03:50-10:00:来到代码仓库-Actions，讲解 workflows。讲解内容为成功失败执行过程的状态以及 job 在 Github 上Actions 中的执行结果，结论：遇到错误看日志 。")]),t._v(" "),s("li",[t._v("10:00-10:56 :总结回顾步骤 steps 的四种形式 (我的理解是并不是四种形式，是属于一种：steps 下面的 name属性可省略；uses 是是否有使用第三方 actions的需求，可选；run：执行脚本，可选)")]),t._v(" "),s("li",[t._v("11:00-12:57:本章小结\n"),s("ul",[s("li",[t._v("认识 Github Actions")]),t._v(" "),s("li",[t._v("应用场景")]),t._v(" "),s("li",[t._v("yml语法格式")])])])]),t._v(" "),s("p",[s("strong",[t._v("2-4 Github actions 做自动化测试")]),t._v("\n新建 yml 文件")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" test\n\n"),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("branches")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" master\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("paths")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.github/workflows/**'")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__test__/**'")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src/**'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("jobs")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        runs"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("on"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ubuntu"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("latest\n\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("steps")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" uses"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" actions"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("checkout@v2\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Use Node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n              "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" actions"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("setup"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("node@v1\n              "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n                  node"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("version"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" lint and test\n              "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n                  npm i\n                  npm run lint\n                  npm run test"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("remote\n")])])]),s("p",[t._v("本节讲 Github actions 做自动测试")]),t._v(" "),s("ul",[s("li",[t._v("00:00-- 03:00   test.yml 代码讲解")])]),t._v(" "),s("p",[t._v("主要自动测试命令为 npm run lint 和 npm run test:remote(补充：checkout 与setup-node 是 actions 仓库比较常用的两个 actions，分别表示下载代码和安装 node)")]),t._v(" "),s("ul",[s("li",[t._v("03:00-- 04:30   本地与远程接口测试")])]),t._v(" "),s("p",[t._v("pre-commit 执行本地接口测试(我的遗留问题："),s("strong",[t._v("关于 pre-commit 部分")]),t._v(")\nmaster push 远程接口测试")]),t._v(" "),s("ul",[s("li",[t._v("04:30 -- 04:50")])]),t._v(" "),s("p",[t._v("测试 「测试部署机」部署完毕")]),t._v(" "),s("ul",[s("li",[t._v("04:45 --  05:30  branches 讲解")])]),t._v(" "),s("p",[t._v("关于 branches 分支的一些注意说明")]),t._v(" "),s("ul",[s("li",[t._v("05:30 --09:50  分支提交actions 讲解\n"),s("ul",[s("li",[t._v("这里由于直接下载的代码为开源版本，与课程内容代码出入非常大，因此需要对开源的代码进行操作")]),t._v(" "),s("li",[t._v("如果将 test.yml 分支改为 main，push到我们自己仓库的时候, actions日志中会发现 lin and test 出现大量错误")]),t._v(" "),s("li",[t._v("课程给出的开源代码一团，我们为了修正这个错误，我们要去修改、甚至删除那些相应的代码，这里非常不得劲")])])])]),t._v(" "),s("p",[s("strong",[t._v("还是那个疑问，为什么不整个与课程同步的代码仓库？这个对学员来说究竟是不是必要的？")]),s("br"),t._v("\n经过笨拙的尝试，终于成功。")]),t._v(" "),s("p",[s("strong",[t._v("2-5 Github actions 章总结")]),s("br"),t._v("\n没说什么新的内容")]),t._v(" "),s("h2",{attrs:{id:"第三章-docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第三章-docker"}},[t._v("#")]),t._v(" 第三章 Docker")]),t._v(" "),s("p",[s("strong",[t._v("3-1 Docker 章介绍")]),s("br"),t._v("\nDocker\n基于 Docker，我们可以把开发、测试环境，一键部署到任何一台机器上。只要该机器安装了 Docker。\n有了 Docker，就有了一切。")]),t._v(" "),s("p",[t._v("主要产出"),s("br"),t._v("\n使用 Docker 构建 nodejs 项目")]),t._v(" "),s("p",[t._v("主要内容"),s("br"),t._v("\n认识 Dcoker\nDockerfile")]),t._v(" "),s("p",[t._v("注意事项"),s("br"),t._v("\n专业的运维工程师对 Docker还有更全面的应用：弹性扩展、微服务等。")]),t._v(" "),s("p",[s("strong",[t._v("3-2 认识 Docker")]),s("br"),t._v("\n介绍"),s("br"),t._v("\nDocker 就是一种虚拟机技术，比传统虚拟机(VMware、virtualBox)更加简单、轻量")]),t._v(" "),s("ul",[s("li",[t._v("启动快")]),t._v(" "),s("li",[t._v("资源占用少")]),t._v(" "),s("li",[t._v("体积小")])]),t._v(" "),s("p",[t._v("查找 docker 安装镜像\n"),s("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://hub.docker.com/"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/liugezhou/image@master/imooc-course/15-1.5y49r0icxak0.webp",alt:"15-1"}})]),t._v(" "),s("p",[s("strong",[t._v("3-3 启动一个Docker容器")])]),t._v(" "),s("p",[s("strong",[t._v("image镜像")])]),t._v(" "),s("ul",[s("li",[t._v("下载镜像 docker pull "),s("code",[t._v("<image-name>")]),t._v(":"),s("code",[t._v("<tag>")])]),t._v(" "),s("li",[t._v("查看所有镜像： docker images")]),t._v(" "),s("li",[t._v("删除镜像：    docker rmi "),s("code",[t._v("<images-id>")])]),t._v(" "),s("li",[t._v("上传镜像：    docker push "),s("code",[t._v("<username>/<password>:<tags>")])]),t._v(" "),s("li",[t._v("如果出现REPOSITORY为 null 的情况时，使用docker image prune删除")])]),t._v(" "),s("p",[s("strong",[t._v("container")])]),t._v(" "),s("ul",[s("li",[t._v("启动容器："),s("strong",[t._v("docker run -p xxxx:xxx -v=hostpath:containerPath -d --name "),s("code",[t._v("<container-name> <image-name>")])]),t._v(" "),s("ul",[s("li",[t._v("-p 端口映射")]),t._v(" "),s("li",[t._v("-v 数据卷，文件映射")]),t._v(" "),s("li",[t._v("-d 后台运行")]),t._v(" "),s("li",[t._v("--name 定义容器名称")])])]),t._v(" "),s("li",[t._v("查看所有容器 docker ps, 加 -a 显示隐藏的容器")]),t._v(" "),s("li",[t._v("停止容器 docker stop "),s("code",[t._v("<container-id>")])]),t._v(" "),s("li",[t._v("删除容器 docker rm "),s("code",[t._v("<contaier-id>")]),t._v(",加-f 是强制删除")]),t._v(" "),s("li",[t._v("查看容器信息，如 IP 地址 docker inspect "),s("code",[t._v("<container-id>")])]),t._v(" "),s("li",[t._v("查看容器日志 docker logs "),s("code",[t._v("<container-id>")])]),t._v(" "),s("li",[t._v("进入容器控制台 docker exec -it "),s("code",[t._v("<container-id>")]),t._v(" /bin/sh")])]),t._v(" "),s("p",[s("strong",[t._v("3-4 Docker容器的进一步演示")]),t._v(" "),s("strong",[t._v("功能演示")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("docker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("81")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("name nginx1 nginx\ndocker ps\n\n# 访问 localhost"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("81")]),t._v(" ，并查看 log\n\ndocker exec "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("it "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("<container-id>")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("sh\ncd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("share"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html\necho hello docker world index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html\nexit\n\n# 重新访问 localhost"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("81")]),t._v(" ，强制刷新\n\ndocker stop "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("<container-id>")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\ndocker rm "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("<container-id>")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n\n")])])]),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("# "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" 新建 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Users"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("wfp"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html ，内容自定义即可\n\n# "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v(" 运行\ndocker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("81")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Users"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("wfp"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("share"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("name nginx1 nginx\n\n# "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.")]),t._v(" 访问 重新访问 localhost"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("81")]),t._v(" ，看是否你创建的页面？\n\n")])])]),s("p",[s("strong",[t._v("3-5 介绍 Dockerfile 语法")]),s("br"),t._v("\n一个简单的配置文件，描述如何构建一个新的 image 镜像"),s("br"),t._v("\n注意：必须是 Dockerfile 这个文件名，必须在项目的根目录")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("# Dockerfile\n\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("FROM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("node")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("latest\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WORKDIR")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("COPY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app\n\n# 设置时区\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" ln "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("sf "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("share"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("zoneinfo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Asia"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Shanghai "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localtime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" echo "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Asia/Shanghai'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("timezone\n#安装\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" npm "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" registry https"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("npm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("taobao"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("org\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" npm install\n#启动\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CMD")]),t._v(" echo #"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SERVER_NAME")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("echo "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AUTHOR_NAME")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" npm run dev "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" npx pm2 log\n\n#环境变量\n\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENV")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SERVER_NAME")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENV")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AUTHOR_NAME")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"liugezhou"')]),t._v("\n\n")])])]),s("p",[s("strong",[t._v("3-6 用 Dockerfile 构建镜像")]),t._v(" "),s("strong",[t._v("构建")])]),t._v(" "),s("ul",[s("li",[t._v("docker build -t "),s("code",[t._v("<name>")]),t._v(".  #最后的'.'指 Dockerfile 在当前目录下。")]),t._v(" "),s("li",[t._v("docker images")])]),t._v(" "),s("p",[s("strong",[t._v("课程修改代码为(去掉routes/index.js的数据库连接以及bin/www中的数据库同步)：")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("# Dockerfile\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("FROM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("node")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WORKDIR")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("COPY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app\n\n# 设置时区\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" ln "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("sf "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("share"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("zoneinfo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Asia"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Beijing "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localtime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" echo "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Asia/Beijing'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("timezone\n\n#安装\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v("  npm "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" registry https"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("npm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("taobao"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("org\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" npm install\n\n#启动\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CMD")]),t._v(" echo $"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SERVER_NAME")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" echo $"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AUTHOR_NAME")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" npm run dev "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" npx pm2 log\n\n#环境变量\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENV")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SERVER_NAME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lego-node-server"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENV")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AUTHOR_NAME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"liugezhou"')]),t._v("\n")])])]),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 步骤一：构建")]),t._v("\ndocker build "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("t liugezhou"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("  # name为将要构建镜像的名字，"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" 为当前目录\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 步骤二：查看")]),t._v("\ndocker images\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//步骤三：启动")]),t._v("\ndocker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("name server1 liugezhou"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server  # 创建容器，注意端口映射\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//步骤四：查看启动状态")]),t._v("\ndocker ps\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 步骤五 查看容器日志")]),t._v("\ndocker logs "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("<container-id>")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("  # 需等待构建完成\n\n# 访问 localhost"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("api"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("check ，查看 docker logs\n\ndocker stop "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("<container-id>")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\ndocker rm "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("<container-id>")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\ndocker rmi "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("<image-id>")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n\n")])])]),s("h2",{attrs:{id:"第四章-docker-compose"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第四章-docker-compose"}},[t._v("#")]),t._v(" 第四章 Docker-compose")]),t._v(" "),s("p",[s("strong",[t._v("4-1 docker-compose 章开始")]),s("br"),t._v("\n总的来说就是 Docker-compose就是一种组合，这章学到的内容就是这个英文单词的翻译。")]),t._v(" "),s("p",[s("strong",[t._v("4-2 docker-compose 配置文件")])]),t._v(" "),s("ul",[s("li",[t._v("文件名称必须为 "),s("strong",[t._v("docker-compose.yml")])]),t._v(" "),s("li",[t._v("代码演示：多个service，代表多个docker镜像")]),t._v(" "),s("li",[t._v("**image:redis **     表示引用官网的redis 镜像")]),t._v(" "),s("li",[t._v("container-name    镜像名称")]),t._v(" "),s("li",[t._v("ports    端口映射")]),t._v(" "),s("li",[t._v("enviroment    环境变量 - TZ")]),t._v(" "),s("li",[t._v("build：    docker build -t  "),s("code",[t._v("<image-name>")]),t._v(" .\n"),s("ul",[s("li",[t._v("context .  ：「当前目录」")]),t._v(" "),s("li",[t._v("dockerfile：Dockerfile   ： 「基于Dockerfile构建」")])])])]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[t._v("version"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\nservices"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("  # service name\n        build"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            context"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("  # 当前目录\n            dockerfile"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Dockerfile  # 基于 Dockerfile 构建\n        image"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server # 依赖于当前 Dockerfile 创建出来的镜像\n        container_name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server\n        ports"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v(" # 宿主机通过 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),t._v(" 访问\n    editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("redis"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("  # service name，重要！\n        image"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" redis  # 引用官网 redis 镜像\n        container_name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("redis\n        ports"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n # 宿主机，可以用 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6378")]),t._v(" 即可连接容器中的数据库 "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("redis-cli -h 127.0.0.1 -p 6378")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n # 但是，其他 docker 容器不能，因为此时 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v(" 是 docker 容器本身，而不是宿主机\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6378")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n        environment"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Asia"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Shanghai # 设置时区\n\n")])])]),s("p",[s("strong",[t._v("4-3 docker-compose 命令演示")])]),t._v(" "),s("ul",[s("li",[t._v("00：00    --    02：55    "),s("strong",[t._v("命令")]),t._v(" "),s("ul",[s("li",[t._v("docker-compose build "),s("code",[t._v("<service-name>")])]),t._v(" "),s("li",[t._v("启动所有服务器：docker-compose up -d (后台启动)")]),t._v(" "),s("li",[t._v("停止所有服务：    docker-compose down")]),t._v(" "),s("li",[t._v("查看服务：    docker-compose ps")]),t._v(" "),s("li",[t._v("docker 与docker-compose的命令执行范围")])])]),t._v(" "),s("li",[t._v("02：55    --    05：10    "),s("strong",[t._v("安装pm2")]),t._v(" "),s("ul",[s("li",[t._v("本地安装pm2  npm i pm2 --S,或者Dockerfile中全局安装pm2")]),t._v(" "),s("li",[t._v("再次强调 「阻塞控制台的命令」")])])]),t._v(" "),s("li",[t._v("05：10    --    06 :30    "),s("strong",[t._v("代码修改")]),t._v(" "),s("ul",[s("li",[t._v("新建 docker-compose.yml")]),t._v(" "),s("li",[t._v("新建 config/envs/prd-dev.js")])])]),t._v(" "),s("li",[t._v("06：30    --    08：16    "),s("strong",[t._v("prd-dev.js文件")]),t._v(" "),s("ul",[s("li",[t._v("内容为修改redis连接配置，讲解")])])]),t._v(" "),s("li",[t._v("08：19    --    10：00    画图？\n"),s("ul",[s("li",[t._v("罗里吧嗦")])])]),t._v(" "),s("li",[t._v("10：01    --    10：48    代码修改\n"),s("ul",[s("li",[t._v("wtf，也不知道是出于什么原因，如此设计课程，观看视频体验 ：一颗星")])])]),t._v(" "),s("li",[t._v("10：49    --    13：17    "),s("strong",[t._v("build")]),t._v(" "),s("ul",[s("li",[t._v("docker-compose build  editor-server")])])]),t._v(" "),s("li",[t._v("13：18    --    15：12    "),s("strong",[t._v("演示")]),t._v(" "),s("ul",[s("li",[t._v("docker images     查看build是否成功")]),t._v(" "),s("li",[t._v("docker-compose -d")]),t._v(" "),s("li",[t._v("docker-compose ps")]),t._v(" "),s("li",[t._v("docker ps")]),t._v(" "),s("li",[t._v("访问：localhost:8081/api/db-check")])])]),t._v(" "),s("li",[t._v("15：12    --    17：17    "),s("strong",[t._v("redis-cli")]),t._v(" "),s("ul",[s("li",[t._v("终端输入："),s("strong",[t._v("redis-cli")]),t._v("，进入到本地redis服务,查看本地 keys *。\n"),s("ul",[s("li",[t._v("「执行redis-cli，我本地显示：Could not connect to Redis at 127.0.0.1:6379: Connection refused；这是因为我本地没启redis服务，于是：redis-server启动，redis-cli进入redis控制台」")])])]),t._v(" "),s("li",[s("strong",[t._v("redis-cli -h 127.0.0.1 -p 6378")]),t._v("      进入到docker容器中的redis")])])]),t._v(" "),s("li",[t._v("17：18    --    18：25    "),s("strong",[t._v("查看日志、down")]),t._v(" "),s("ul",[s("li",[t._v("docker logs "),s("code",[t._v("<container-id>")])]),t._v(" "),s("li",[t._v("docker-compose down")])])])]),t._v(" "),s("p",[s("strong",[t._v("4-4 数据持久化")]),t._v(" "),s("strong",[t._v("连接mysql和mongodb")]),t._v(" "),s("strong",[t._v("区别:")])]),t._v(" "),s("ul",[s("li",[t._v("redis无数据库，mysql与mongodb需要连接数据库")]),t._v(" "),s("li",[t._v("redis是缓存，无需数据持久化，mysql与mongodb需要**。**")])]),t._v(" "),s("p",[t._v("volumes:")]),t._v(" "),s("ul",[s("li",[t._v("'.docker-volumes/mongo/data:/data/db' # 数据持久化")])]),t._v(" "),s("p",[s("strong",[t._v("4-5 配置 mysql")])]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[t._v("version"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\nservices"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        build"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            context"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n            dockerfile"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Dockerfile\n        image"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server # 依赖于当前 Dockerfile 创建镜像\n        container_name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server\n        ports"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v(" # 宿主机通过 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),t._v(" 访问\n    editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("redis"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        image"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" redis # 引用官网 redis 镜像\n        container_name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("redis\n        ports"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6378")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v(" # 宿主机可以用 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6378")]),t._v(" 即可连接容器中的数据库\n        environment"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Asia"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Beijing # 设置时区\n    editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("mysql"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        image"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mysql # 引用官网 mysql 镜像\n        container_name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("mysql\n        restart"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" always\n        privileged"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" # 高权限，执行下面的 mysql"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("init\n        command"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("authentication"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("plugin"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mysql_native_password # 解决无法远程访问的问题\n        ports"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3305")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(" # 宿主机可以用 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3305")]),t._v(" 即可连接容器中的数据库\n        volumes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("volumes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mysql"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("log"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("log"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mysql # 数据持久化\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("volumes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mysql"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("lib"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mysql\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mysql"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("init"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("entrypoint"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("initdb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("d"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" # 初始化 sql\n        environment"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MYSQL_DATABASE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("imooc_lego_course # 初始化容器时创建数据库\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("liugezhou1205\n            # "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MYSQL_USER")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("shuangyue #创建 test 用户\n            # "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MYSQL_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("shuangyue #设置 test 用户的密码\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Asia"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Beijing # 设置时区\n    editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("mongo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        image"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mongo # 引用官网 mongo 镜像\n        container_name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("mongo\n        restart"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" always #出错则重启\n        volumes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.docker-volumes/mongo/data:/data/db'")]),t._v(" # 数据持久化\n        environment"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MONGO_INITDB_DATABASE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("imooc_lego_course\n            # "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MONGO_INITDB_ROOT_USERNAME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root\n            # "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MONGO_INITDB_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Asia"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Beijing # 设置时区\n        ports"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'27016:27017'")]),t._v(" # 宿主机可以用 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("27016")]),t._v(" 即可连接容器中的数据库\n\n")])])]),s("h2",{attrs:{id:"第五章-发布到测试机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第五章-发布到测试机"}},[t._v("#")]),t._v(" 第五章 发布到测试机")]),t._v(" "),s("p",[s("strong",[t._v("5-2  配置测试机")]),t._v(" "),s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/liugezhou/image@master/imooc-course/15-2.5so88ss1y340.webp",alt:"15-2"}})]),t._v(" "),s("p",[s("strong",[t._v("5-3 自动发布到测试机-讲解配置")]),t._v(" "),s("strong",[t._v("5-4 自动发布到测试机-功能演示")])]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[t._v("# This workflow will "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" a clean install "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" node dependencies"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" build the source code and run tests across different versions "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" node\n# For more information see"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("help"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("actions"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("language"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("and"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("framework"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("guides"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("using"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("nodejs"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("github"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("actions\n# github actions 中文文档 https"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("cn"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("actions"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("getting"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("started"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("github"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("actions\n\nname"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" deploy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" dev\n\non"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\npush"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\nbranches"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dev'")]),t._v(" # 只针对 dev 分支\npaths"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.github/workflows/*'")]),t._v("\n# "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__test__/**'")]),t._v(" # dev 不需要立即测试\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src/**'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Dockerfile'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'docker-compose.yml'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bin/*'")]),t._v("\n\njobs"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  deploy"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dev"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n \t runs"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("on"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ubuntu"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("latest\n\n    steps"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" uses"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" actions"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("checkout"),s("span",{pre:!0,attrs:{class:"token decorator"}},[s("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("v2")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" ssh key # 临时设置 ssh key\n      run"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n        mkdir "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v(".ssh")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),t._v("\n    echo "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${{secrets.WFP_ID_RSA}}"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssh"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("id_rsa\n    # secret 在这里配置 https"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("imooc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("lego"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("biz"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("settings"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("secrets\n    chmod "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssh"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("id_rsa\n    ssh"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("keyscan "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"182.92.xxx.xxx"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssh"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("known_hosts\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" deploy # 部署\n      run"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n        ssh work"),s("span",{pre:!0,attrs:{class:"token decorator"}},[s("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("182")])]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".92")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v('xxx "\n# 【注意】用 work 账号登录，手动创建 '),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("work"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("imooc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("lego 目录\n# 然后 git clone https"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("username"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("password"),s("span",{pre:!0,attrs:{class:"token decorator"}},[s("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("github")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("imooc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("lego"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("biz"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("git "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("b dev （私有仓库，使用 github 用户名和密码）\n    # 记得删除 origin ，否则会暴露 github 密码\n\n    cd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("work"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("imooc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("lego"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("biz"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    git remote add origin https"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("wangfupeng1988"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("secrets"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WFP_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token decorator"}},[s("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("github")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("imooc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("lego"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("biz"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("git"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    git checkout dev"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    git pull origin dev"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" # 重新下载最新代码\n    git remote remove origin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" # 删除 origin ，否则会暴露 github 密码\n    # 启动 docker\n    docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("compose build editor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" # 和 docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("compose"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yml service 名字一致\n    docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("compose up "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v('\n    "\n      '),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("delete")]),t._v(" ssh key # 删除 ssh key\n      run"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" rm "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rf "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssh"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("id_rsa\n")])])]),s("p",[s("strong",[t._v("5-5 自动发布到测试机--章总结")])]),t._v(" "),s("blockquote",[s("p",[t._v("😔")])])])}),[],!1,null,null,null);s.default=e.exports}}]);